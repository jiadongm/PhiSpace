<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Find spatial niches by clustering PhiSpace scores — findNiches • PhiSpace</title><!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="../favicon-48x48.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Find spatial niches by clustering PhiSpace scores — findNiches"><meta property="og:description" content="Identifies spatial niches by performing k-means clustering on PhiSpace cell type scores.
Optionally performs PCA before clustering to reduce dimensionality and improve clustering performance.
Can test multiple numbers of niches and return all results for comparison."><meta property="og:image" content="https://jiadongm.github.io/PhiSpace/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PhiSpace</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Find spatial niches by clustering PhiSpace scores</h1>

    <div class="hidden name"><code>findNiches.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Identifies spatial niches by performing k-means clustering on PhiSpace cell type scores.
Optionally performs PCA before clustering to reduce dimensionality and improve clustering performance.
Can test multiple numbers of niches and return all results for comparison.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">findNiches</span><span class="op">(</span></span>
<span>  <span class="va">spe</span>,</span>
<span>  reducedDimName <span class="op">=</span> <span class="st">"PhiSpace"</span>,</span>
<span>  <span class="va">n_niches</span>,</span>
<span>  use_pca <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ncomp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  center <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  kmeans_iter <span class="op">=</span> <span class="fl">500L</span>,</span>
<span>  kmeans_nstart <span class="op">=</span> <span class="fl">20L</span>,</span>
<span>  kmeans_algorithm <span class="op">=</span> <span class="st">"Lloyd"</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">94863</span>,</span>
<span>  store_pca <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  pca_name <span class="op">=</span> <span class="st">"PhiSpace_PCA"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-spe">spe<a class="anchor" aria-label="anchor" href="#arg-spe"></a></dt>
<dd><p>SpatialExperiment or SingleCellExperiment object containing PhiSpace scores.</p></dd>


<dt id="arg-reduceddimname">reducedDimName<a class="anchor" aria-label="anchor" href="#arg-reduceddimname"></a></dt>
<dd><p>Name of the reducedDim containing PhiSpace scores (default: "PhiSpace").</p></dd>


<dt id="arg-n-niches">n_niches<a class="anchor" aria-label="anchor" href="#arg-n-niches"></a></dt>
<dd><p>Integer or vector of integers. Number(s) of niches (clusters) to identify.
If a vector is provided, multiple clustering results will be generated.</p></dd>


<dt id="arg-use-pca">use_pca<a class="anchor" aria-label="anchor" href="#arg-use-pca"></a></dt>
<dd><p>Logical. Whether to perform PCA before clustering (default: TRUE).</p></dd>


<dt id="arg-ncomp">ncomp<a class="anchor" aria-label="anchor" href="#arg-ncomp"></a></dt>
<dd><p>Integer. Number of principal components to use if use_pca = TRUE.
If NULL, defaults to half the number of cell types in PhiSpace scores.</p></dd>


<dt id="arg-center">center<a class="anchor" aria-label="anchor" href="#arg-center"></a></dt>
<dd><p>Logical. Whether to center data for PCA (default: TRUE).</p></dd>


<dt id="arg-scale">scale<a class="anchor" aria-label="anchor" href="#arg-scale"></a></dt>
<dd><p>Logical. Whether to scale data for PCA (default: FALSE).</p></dd>


<dt id="arg-kmeans-iter">kmeans_iter<a class="anchor" aria-label="anchor" href="#arg-kmeans-iter"></a></dt>
<dd><p>Integer. Maximum number of iterations for k-means (default: 500).</p></dd>


<dt id="arg-kmeans-nstart">kmeans_nstart<a class="anchor" aria-label="anchor" href="#arg-kmeans-nstart"></a></dt>
<dd><p>Integer. Number of random starts for k-means (default: 20).</p></dd>


<dt id="arg-kmeans-algorithm">kmeans_algorithm<a class="anchor" aria-label="anchor" href="#arg-kmeans-algorithm"></a></dt>
<dd><p>Character. Algorithm for k-means clustering (default: "Lloyd").</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>Integer. Random seed for reproducibility (default: 94863).</p></dd>


<dt id="arg-store-pca">store_pca<a class="anchor" aria-label="anchor" href="#arg-store-pca"></a></dt>
<dd><p>Logical. Whether to store PCA results in the object (default: FALSE).</p></dd>


<dt id="arg-pca-name">pca_name<a class="anchor" aria-label="anchor" href="#arg-pca-name"></a></dt>
<dd><p>Character. Name for stored PCA results if store_pca = TRUE (default: "PhiSpace_PCA").</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>The input object with niche assignments added to colData. If a single n_niches is provided,
results are stored as "spatial_niches". If multiple n_niches are provided, results are stored as
"spatial_niches_k7", "spatial_niches_k8", etc. If store_pca = TRUE, PCA results are also stored in reducedDims.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function identifies spatial niches by clustering cells/spots based on their PhiSpace
cell type composition scores. The workflow consists of:</p><ol><li><p>Extract PhiSpace scores from the specified reducedDim</p></li>
<li><p>Optionally perform PCA to reduce dimensionality and focus on major patterns</p></li>
<li><p>Apply k-means clustering to identify niches (for each k in n_niches)</p></li>
<li><p>Store niche assignments in colData</p></li>
</ol><p>PCA is recommended when you have many cell types (&gt;20) as it can improve clustering
by focusing on the main axes of variation in cell type composition.</p>
<p>When multiple values of n_niches are provided, the function will test each one and store
all results, allowing you to compare different numbers of niches and choose the most
appropriate one for your analysis.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Basic usage - find 9 niches using PCA</span></span></span>
<span class="r-in"><span><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu">findNiches</span><span class="op">(</span><span class="va">spe</span>, n_niches <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Test multiple numbers of niches</span></span></span>
<span class="r-in"><span><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu">findNiches</span><span class="op">(</span><span class="va">spe</span>, n_niches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Find niches without PCA</span></span></span>
<span class="r-in"><span><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu">findNiches</span><span class="op">(</span><span class="va">spe</span>, n_niches <span class="op">=</span> <span class="fl">6</span>, use_pca <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Custom PCA settings</span></span></span>
<span class="r-in"><span><span class="va">spe</span> <span class="op">&lt;-</span> <span class="fu">findNiches</span><span class="op">(</span><span class="va">spe</span>, n_niches <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span>, ncomp <span class="op">=</span> <span class="fl">15</span>, store_pca <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Access niche assignments</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">spe</span><span class="op">$</span><span class="va">spatial_niches</span><span class="op">)</span>  <span class="co"># for single n_niches</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">spe</span><span class="op">$</span><span class="va">spatial_niches_k8</span><span class="op">)</span>  <span class="co"># for multiple n_niches</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Visualize niches spatially</span></span></span>
<span class="r-in"><span><span class="fu"><a href="VizSpatial.html">VizSpatial</a></span><span class="op">(</span><span class="va">spe</span>, groupBy <span class="op">=</span> <span class="st">"spatial_niches"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="VizSpatial.html">VizSpatial</a></span><span class="op">(</span><span class="va">spe</span>, groupBy <span class="op">=</span> <span class="st">"spatial_niches_k8"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by <a href="https://github.com/jiadongm" class="external-link">Jiadong Mao</a>.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer></div>






  </body></html>

