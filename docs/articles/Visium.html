<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visium: cell type deconvolution for multi-cellular spots • PhiSpace</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Visium: cell type deconvolution for multi-cellular spots">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PhiSpace</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>

  </a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Visium: cell type deconvolution for
multi-cellular spots</h1>
                        <h4 data-toc-skip class="author">Jiadong
Mao</h4>
            
            <h4 data-toc-skip class="date">2025-04-29</h4>
      

      <div class="hidden name"><code>Visium.Rmd</code></div>

    </div>

    
    
<div class="section level3">
<h3 id="highlights">Highlights<a class="anchor" aria-label="anchor" href="#highlights"></a>
</h3>
<ul>
<li><p>Interpretable cell type deconvolution;</p></li>
<li><p>Healthy reference annotates cancerous query;</p></li>
<li><p>Insightful cell type colocalisation analysis.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>In this case study, we will apply PhiSpace to cell type
deconvolution:</p>
<ul>
<li>Query: Visium dataset consisting of samples from non-small cell lung
cancer (NSCLC) patients (<a href="https://www.nature.com/articles/s41467-024-48700-8" class="external-link">De Zuani et
al., 2024</a>).</li>
<li>Reference: the Human Lung Cell Atlas (HLCA) scRNA-seq data (<a href="https://www.nature.com/articles/s41591-023-02327-2" class="external-link">Sikkema et
al., 2023</a>).</li>
</ul>
<p>10x Visium is a supercellular spatial transcriptomics (ST) platform.
The minimal measurement unit for the Visium platform are 55μm spots,
where each spot potentially contains multiple cells. In this context,
cell type deconvolution refers to the statistical task of estimating the
cell type abundance in each spot.</p>
<p>For this case study, we have defined some util functions, which can
be downloaded <a href="https://www.dropbox.com/scl/fi/glsnt6cr95pxr6tgaff34/Visium_utils.R?rlkey=hp7m6we4algotq28vogngy0i2&amp;st=r1o4p6lp&amp;dl=0" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Name of the game</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jiadongm.github.io/PhiSpace/">PhiSpace</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Tidyverse packages</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rpkgs.datanovia.com/ggpubr/" class="external-link">ggpubr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Other utils</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/qsbase/qs" class="external-link">qs</a></span><span class="op">)</span><span class="op">)</span> <span class="co"># Fast read and write of large R objects</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/message.html" class="external-link">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/jokergoo/ComplexHeatmap" class="external-link">ComplexHeatmap</a></span><span class="op">)</span><span class="op">)</span> <span class="co"># plot heatmap</span></span>
<span></span>
<span><span class="va">dat_dir</span> <span class="op">&lt;-</span> <span class="st">"~/Dropbox/Research_projects/PhiSpace/VignetteData/Visium/"</span> <span class="co"># replace this by your own directory</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dat_dir</span>, <span class="st">"Visium_utils.R"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-preparation">Data preparation<a class="anchor" aria-label="anchor" href="#data-preparation"></a>
</h2>
<p>Download the following files:</p>
<ul>
<li>
<a href="https://www.dropbox.com/scl/fi/uwadtwn8quzp93tdzvveb/AzimuthLung2.0_sce_0.1sub.qs?rlkey=0129nrgzw538naou6n8zznubw&amp;st=xmd3jo67&amp;dl=0" class="external-link">Reference</a>,
which is a 10% subset of the HLCA.</li>
<li>
<a href="https://www.dropbox.com/scl/fi/qzj0jpxscy1zlrc0hqv19/allTissues.qs?rlkey=qqckkewm5n2r8f4txj39tfeso&amp;st=x6q83dkv&amp;dl=0" class="external-link">Query</a>,
which is a list of 40 Visium samples from healthy and cancerous lungs.
As in our PhiSpace paper, we will only use 18 of them (1 background + 1
cancerous from each of 9 patients) which are of better data
quality.</li>
<li>The PhiSpace <a href="https://www.dropbox.com/scl/fi/vylbs7axes169w6mhxbkq/refImpScores.qs?rlkey=xc6om57frg0q95soqjp5zg1ar&amp;st=lljdmwoq&amp;dl=0" class="external-link">importance
scores</a>, which measures how important all the gene features are for
predicting cell types in the reference.</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">reference</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/qs/man/qread.html" class="external-link">qread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dat_dir</span>, <span class="st">"data/LungRef/AzimuthLung2.0_sce_0.1sub.qs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">impScores</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/qs/man/qread.html" class="external-link">qread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dat_dir</span>, <span class="st">"output/refImpScores.qs"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">query_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/qs/man/qread.html" class="external-link">qread</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dat_dir</span>, <span class="st">"data/Visium_NSCLC/allTissues.qs"</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">18</span><span class="op">]</span></span></code></pre></div>
<p>Visualise a cancerous sample P11_T3. Here we look at two markers:
KRT19 (also known as CYFRA21-1), a NSCLC marker and CD79A, a B cell
marker.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VisTissueName</span> <span class="op">&lt;-</span> <span class="st">"P11_T3"</span></span>
<span><span class="va">qu_vis</span> <span class="op">&lt;-</span> <span class="va">query_list</span><span class="op">[[</span><span class="va">VisTissueName</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/VizSpatial.html">VizSpatial</a></span><span class="op">(</span><span class="va">qu_vis</span>, feature <span class="op">=</span> <span class="st">"KRT19"</span>, assay2use <span class="op">=</span> <span class="st">"log1p"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visium_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/VizSpatial.html">VizSpatial</a></span><span class="op">(</span><span class="va">qu_vis</span>, feature <span class="op">=</span> <span class="st">"CD79A"</span>, assay2use <span class="op">=</span> <span class="st">"log1p"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visium_files/figure-html/unnamed-chunk-3-2.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="run-phispace">Run PhiSpace<a class="anchor" aria-label="anchor" href="#run-phispace"></a>
</h2>
<p>Run PhiSpace using all the genes can be RAM-demanding, hence we
select 500 genes that are most useful for predicting each cell type.
This gives us 4613 genes. However, if RAM is still not enough, simply
download the annotation results from <a href="https://www.dropbox.com/scl/fi/v2i62f229lbhtzofco430/combo_PhiRes.qs?rlkey=g1k0ubpx83gs83wjfg4h0psu2&amp;st=hbi77arg&amp;dl=0" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">YtrainName</span> <span class="op">&lt;-</span> <span class="st">"ann_finest_level"</span></span>
<span><span class="va">selectedFeat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/selectFeat.html">selectFeat</a></span><span class="op">(</span><span class="va">impScores</span>, <span class="fl">500</span><span class="op">)</span><span class="op">$</span><span class="va">selectedFeat</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">selectedFeat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 4613</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">PhiResPath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">dat_dir</span>, <span class="st">"output/combo_PhiRes.qs"</span><span class="op">)</span></span>
<span><span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="va">PhiResPath</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">PhiRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PhiSpaceR_1ref.html">PhiSpaceR_1ref</a></span><span class="op">(</span></span>
<span>    <span class="va">reference</span>, </span>
<span>    <span class="va">query_list</span>, </span>
<span>    phenotypes <span class="op">=</span> <span class="va">YtrainName</span>, </span>
<span>    PhiSpaceAssay <span class="op">=</span> <span class="st">"log1p"</span>,</span>
<span>    selectedFeat <span class="op">=</span> <span class="va">selectedFeat</span>,</span>
<span>    regMethod <span class="op">=</span> <span class="st">"PLS"</span>, </span>
<span>    center <span class="op">=</span> <span class="cn">T</span>,</span>
<span>    scale <span class="op">=</span> <span class="cn">F</span></span>
<span>  <span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/qs/man/qsave.html" class="external-link">qsave</a></span><span class="op">(</span><span class="va">PhiRes</span><span class="op">$</span><span class="va">PhiSpaceScore</span>, <span class="va">PhiResPath</span><span class="op">)</span></span>
<span><span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>  <span class="va">PhiRes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/qs/man/qread.html" class="external-link">qread</a></span><span class="op">(</span><span class="va">PhiResPath</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>As an example, we visualise the predicted B cell abundance in sample
P11_T3.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/SingleCellExperiment/man/reducedDims.html" class="external-link">reducedDim</a></span><span class="op">(</span><span class="va">qu_vis</span>, <span class="st">"PhiSpace"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">PhiRes</span><span class="op">[[</span><span class="st">"P11_T3"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu"><a href="../reference/VizSpatial.html">VizSpatial</a></span><span class="op">(</span><span class="va">qu_vis</span>, reducedDim <span class="op">=</span> <span class="st">"B cells"</span>, reducedDim2use <span class="op">=</span> <span class="st">"PhiSpace"</span>, censor <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visium_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>How about the performance of other deconvolution methods? How to
compare their performances when there is no ground truth? See the Visium
case study in our <a href="https://www.biorxiv.org/content/10.1101/2025.02.05.636735v1" class="external-link">PhiSpace
ST paper</a> for more details (spoiler alert: PhiSpace was the
best).</p>
</div>
<div class="section level2">
<h2 id="multi-sample-cell-type-co-localisation-analysis">Multi-sample cell type co-localisation analysis<a class="anchor" aria-label="anchor" href="#multi-sample-cell-type-co-localisation-analysis"></a>
</h2>
<p>Obtaining interpretable cell type deconvolution results is only the
first steps towards discovery of spatial biology. We showcase one type
of analysis that can be done based on PhiSpace deconvolution - cell type
colocalisation. The main idea is that, from each sample, we calculate a
cell type correlation matrix (called co-presence matrix in our <a href="https://www.biorxiv.org/content/10.1101/2025.02.05.636735v1" class="external-link">PhiSpace
ST paper</a>), representing how cell types tend to colocalised. Then we
apply dimension reduction methods to these matrices (vectorised) to
visualise them.</p>
<p>First we calcualte the sample-specific correlation matrices and
vectorise them.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">VisTissueNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">query_list</span><span class="op">)</span></span>
<span><span class="va">corMat_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">vector</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">VisTissueNames</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">`names&lt;-`</span><span class="op">(</span><span class="va">VisTissueNames</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">ii</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">VisTissueNames</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">VisTissueName</span> <span class="op">&lt;-</span> <span class="va">VisTissueNames</span><span class="op">[</span><span class="va">ii</span><span class="op">]</span></span>
<span>  <span class="va">PhiScores_norm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/normPhiScores.html">normPhiScores</a></span><span class="op">(</span><span class="va">PhiRes</span><span class="op">[[</span><span class="va">VisTissueName</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></span>
<span>  <span class="va">corMat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="va">PhiScores_norm</span><span class="op">)</span></span>
<span>  <span class="va">corMat_list</span><span class="op">[[</span><span class="va">ii</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">corMat</span></span>
<span><span class="op">}</span></span>
<span><span class="va">cTypeCombo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/outer.html" class="external-link">outer</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">corMat_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">corMat_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"&lt;-&gt;"</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">corMatVec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">corMat_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">`colnames&lt;-`</span><span class="op">(</span><span class="va">VisTissueNames</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">`rownames&lt;-`</span><span class="op">(</span><span class="va">cTypeCombo</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lower.tri.html" class="external-link">lower.tri</a></span><span class="op">(</span><span class="va">cTypeCombo</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Next we simply compute a PCA of all correlation matrices. It turns
out that a simple PCA suffices here as the signal is very strong.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">92394</span><span class="op">)</span></span>
<span><span class="va">pca_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getPC.html">getPC</a></span><span class="op">(</span><span class="va">corMatVec</span>, ncomp <span class="op">=</span> <span class="fl">2</span>, center <span class="op">=</span> <span class="cn">T</span>, scale <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<p>We visualise the first two PCs. As we can see, all samples were well
separated into groups according to disease conditions:</p>
<ul>
<li>Healthy: samples from healthy donors;</li>
<li>Background: non-cancerous tissue from cancerous samples;</li>
<li>LUAD: lung adenocarcinoma;</li>
<li>LUSC: lung squamous cell carcinoma.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tempPCAplot</span><span class="op">(</span><span class="va">pca_res</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">5.5</span>, <span class="fl">7.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visium_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loadBarplot.html">loadBarplot</a></span><span class="op">(</span><span class="va">pca_res</span><span class="op">$</span><span class="va">loadings</span>, nfeat <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visium_files/figure-html/unnamed-chunk-8-2.png" width="700"></p>
<p>In addition to the separation of patients, we can also observe that
LUSC samples tend to have the largest PC1 values, healthy and background
the lowest, and LUAD samples having intermediate PC1 values. Given that
LUSC tends to have worse prognosis than LUAD, layout of the PC plot
about seems to suggest that PC1 represent prognosis to some degree.
Lacking detailed information about patient prognosis from the original
publication, we opt for a data-driven way to find out.</p>
<p>According to <a href="https://www.nature.com/articles/s41598-021-92725-8" class="external-link">Chen &amp;
Dhahbi (2021)</a>, CELSR2 is a marker for better prognosis in LUSC;
KRT17, KRT6A, S100A2, TRIM29, REPS1, and GPC1 are markers for worse
prognosis in LUAD; PERP, ELFN2, ARHGAP12 and QSOX1 are markers for
better prognosis in LUSC. Based on how the favourable prognosis markers
are upregulated (see definition of <code>meanEsts</code> in
<code>Visium_utils.R</code>), we calculated the prognosis scores for all
patients.</p>
<p>Note that since the markers are different for LUSC and LUAD, we
cannot directly compare prognosis scores between LUSC and LUAD patients.
However, the scores are still informative. For example, P24 was
predicted to have the worst prognosis (lowest favourable prognosis
score) among LUAD patients, which probably explained why it was located
closer to LUSC patients on the PCA scatter plot above.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Common gene of all Visium slides</span></span>
<span><span class="va">commonGeneNames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="va">intersect</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">query_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mk_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  LUSC_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CELSR2"</span><span class="op">)</span>,</span>
<span>  LUAD_bad <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"KRT17"</span>, <span class="st">"KRT6A"</span>, <span class="st">"S100A2"</span>, <span class="st">"TRIM29"</span>, <span class="st">"REPS1"</span>, <span class="st">"GPC1"</span><span class="op">)</span>,</span>
<span>  LUAD_good <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PERP"</span>, <span class="st">"ELFN2"</span>, <span class="st">"ARHGAP12"</span>, <span class="st">"QSOX1"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mk_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">mk_list</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://generics.r-lib.org/reference/setops.html" class="external-link">intersect</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">commonGeneNames</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># Function for calculate mean expression level of marker genes in all tissues</span></span>
<span><span class="va">assay2use</span> <span class="op">&lt;-</span> <span class="st">"counts"</span></span>
<span><span class="va">meanGeneLvls</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">query_list</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">18</span><span class="op">]</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums-methods.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/SummarizedExperiment/man/SummarizedExperiment-class.html" class="external-link">assay</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">assay2use</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mkLvls_LUSC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>favourable <span class="op">=</span> <span class="fu">meanEsts</span><span class="op">(</span><span class="va">mk_list</span><span class="op">[[</span><span class="st">"LUSC_good"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="va">mkLvls_LUAD_good</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>favourable <span class="op">=</span> <span class="fu">meanEsts</span><span class="op">(</span><span class="va">mk_list</span><span class="op">[[</span><span class="st">"LUAD_good"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mkLvls_LUAD_bad</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>favourable <span class="op">=</span> <span class="fu">meanEsts</span><span class="op">(</span><span class="va">mk_list</span><span class="op">[[</span><span class="st">"LUAD_bad"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mkLvls_LUAD</span> <span class="op">&lt;-</span> <span class="va">mkLvls_LUAD_good</span><span class="op">/</span><span class="va">mkLvls_LUAD_bad</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  favourable <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">mkLvls_LUSC</span><span class="op">[</span><span class="va">Visium_cancerTypes</span> <span class="op">==</span> <span class="st">"LUSC"</span>,<span class="op">]</span>,</span>
<span>    <span class="va">mkLvls_LUAD</span><span class="op">[</span><span class="va">Visium_cancerTypes</span> <span class="op">==</span> <span class="st">"LUAD"</span>,<span class="op">]</span></span>
<span>  <span class="op">)</span>,</span>
<span>  sample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">VisTissueNames</span><span class="op">[</span><span class="va">Visium_cancerTypes</span> <span class="op">==</span> <span class="st">"LUSC"</span><span class="op">]</span>,</span>
<span>    <span class="va">VisTissueNames</span><span class="op">[</span><span class="va">Visium_cancerTypes</span> <span class="op">==</span> <span class="st">"LUAD"</span><span class="op">]</span></span>
<span>  <span class="op">)</span>, </span>
<span>  cancerType <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="va">Visium_cancerTypes</span><span class="op">[</span><span class="va">Visium_cancerTypes</span> <span class="op">==</span> <span class="st">"LUSC"</span><span class="op">]</span>,</span>
<span>    <span class="va">Visium_cancerTypes</span><span class="op">[</span><span class="va">Visium_cancerTypes</span> <span class="op">==</span> <span class="st">"LUAD"</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">sample</span>, <span class="va">favourable</span>, fill <span class="op">=</span> <span class="va">cancerType</span><span class="op">)</span>, stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="va">VisiumCancerCols</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span><span class="op">)</span>, axis.title.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">cancerType</span>, scales <span class="op">=</span> <span class="st">"free"</span>, ncol <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span>, axis.title.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Visium_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<p>To focus on the role of immune cell types, we repeat the above
analysis using only immune cell types. The separation of disease
conditions was largely retained. Note how plasmacytoid dendritic cells
(pDCs) played an important role in explaining the separation of samples
along PC1.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">immuneDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  celltype <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">corMat_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  immuneOrNot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"immune"</span>, <span class="st">"immune"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"immune"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"immune"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"immune"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"immune"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"immune"</span>, <span class="st">"immune"</span>, <span class="st">"immune"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"immune"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"immune"</span>, <span class="st">"immune"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"immune"</span>, <span class="st">"immune"</span>, <span class="st">"immune"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"immune"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"immune"</span>, <span class="st">"immune"</span>,</span>
<span>    <span class="st">"other"</span>, <span class="st">"other"</span>, <span class="st">"other"</span>,</span>
<span>    <span class="st">"immune"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">immuneCellTypes</span> <span class="op">&lt;-</span> <span class="va">immuneDF</span><span class="op">$</span><span class="va">celltype</span><span class="op">[</span><span class="va">immuneDF</span><span class="op">$</span><span class="va">immuneOrNot</span> <span class="op">==</span> <span class="st">"immune"</span><span class="op">]</span></span>
<span><span class="va">intDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="st">"rbind"</span>, <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">corMatVec</span><span class="op">)</span>, <span class="st">"&lt;-&gt;"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">intIdx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span></span>
<span>  <span class="va">intDF</span>, <span class="fl">1</span>,</span>
<span>  <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">immuneCellTypes</span><span class="op">)</span> <span class="op">|</span> <span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">immuneCellTypes</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">92399</span><span class="op">)</span></span>
<span><span class="va">corMatVec_immune</span> <span class="op">&lt;-</span> <span class="va">corMatVec</span><span class="op">[</span>,<span class="va">intIdx</span><span class="op">]</span></span>
<span><span class="va">pcaImmune_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getPC.html">getPC</a></span><span class="op">(</span><span class="va">corMatVec_immune</span>, ncomp <span class="op">=</span> <span class="fl">2</span>, center <span class="op">=</span> <span class="cn">T</span>, scale <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span>
<span><span class="fu">tempPCAplot</span><span class="op">(</span><span class="va">pcaImmune_res</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/expand_limits.html" class="external-link">expand_limits</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visium_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/loadBarplot.html">loadBarplot</a></span><span class="op">(</span><span class="va">pcaImmune_res</span><span class="op">$</span><span class="va">loadings</span>, <span class="st">"comp1"</span>, nfeat <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<p><img src="Visium_files/figure-html/unnamed-chunk-10-2.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://github.com/jiadongm" class="external-link">Jiadong Mao</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
